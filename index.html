<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Экспресс-диагностика состояния</title>
  <style>
    :root{
      --bg:#0b0f14;
      --card:#121824;
      --card2:#0f1520;
      --text:#e8eef7;
      --muted:#a9b6c7;
      --line:#263247;
      --accent:#7dd3fc;
      --good:#86efac;
      --warn:#fbbf24;
      --bad:#fb7185;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue";
      background: radial-gradient(1200px 700px at 20% 0%, rgba(125,211,252,.12), transparent 55%),
                  radial-gradient(900px 600px at 90% 10%, rgba(134,239,172,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
      line-height:1.35;
    }
    a{ color:var(--accent); text-decoration:none; }
    header{
      padding: 28px 16px 12px;
      max-width: 980px;
      margin: 0 auto;
    }
    .title{
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    h1{
      margin:0;
      font-size: clamp(22px, 3.2vw, 34px);
      letter-spacing: .2px;
    }
    .subtitle{
      margin:10px 0 0;
      color:var(--muted);
      max-width: 820px;
    }
    main{
      max-width: 980px;
      margin: 0 auto;
      padding: 0 16px 40px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 16px;
    }
    @media (max-width: 940px){
      main{ grid-template-columns: 1fr; }
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.03), transparent 30%), var(--card);
      border:1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding: 16px 16px 12px;
      border-bottom:1px solid rgba(255,255,255,.06);
      background: linear-gradient(180deg, rgba(125,211,252,.06), transparent 55%);
    }
    .card .bd{
      padding: 16px;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size: 12px;
      color: var(--muted);
      border:1px solid rgba(255,255,255,.10);
      border-radius: 999px;
      padding: 6px 10px;
      background: rgba(0,0,0,.18);
    }
    .row{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .sectionTitle{
      margin: 0 0 8px;
      font-size: 15px;
      color: var(--text);
      letter-spacing: .2px;
    }
    .hint{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 13px;
    }
    .fieldset{
      border:1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      padding: 12px;
      background: rgba(0,0,0,.16);
      margin: 10px 0 14px;
    }
    .q{
      padding: 10px 0;
      border-top:1px dashed rgba(255,255,255,.08);
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .q:first-child{ border-top:0; padding-top:0; }
    .q:last-child{ padding-bottom:0; }
    .q .txt{ flex: 1; }
    .q .label{
      font-size: 14px;
    }
    .toggles{
      display:flex;
      gap:8px;
      flex-shrink:0;
    }
    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.10);
      color:var(--text);
      background: rgba(255,255,255,.04);
      padding: 9px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 600;
      transition: transform .05s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      border-color: rgba(125,211,252,.35);
      background: rgba(125,211,252,.10);
    }
    .btn.ghost{
      background: transparent;
    }
    .seg{
      display:flex;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
      border-radius: 12px;
      overflow:hidden;
    }
    .seg button{
      border:0;
      border-right:1px solid rgba(255,255,255,.08);
      padding: 8px 10px;
      background: transparent;
      color: var(--muted);
      cursor:pointer;
      font-weight: 700;
      min-width: 54px;
    }
    .seg button:last-child{ border-right:0; }
    .seg button.active{
      color: var(--text);
      background: rgba(255,255,255,.06);
    }
    select{
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline: none;
    }
    .resultBox{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      font-size: 12px;
      color: var(--muted);
    }
    .badge strong{ color:var(--text); }
    .resTitle{
      margin: 4px 0 0;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .resDesc{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 13px;
    }
    .steps{
      margin: 10px 0 0;
      padding: 0;
      list-style: none;
      display:flex;
      flex-direction:column;
      gap: 8px;
    }
    .steps li{
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.16);
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 14px;
    }
    .small{
      font-size: 12px;
      color: var(--muted);
    }
    .scores{
      margin-top: 10px;
      border-top: 1px solid rgba(255,255,255,.06);
      padding-top: 10px;
    }
    .scoreRow{
      display:flex;
      justify-content:space-between;
      gap: 10px;
      padding: 7px 0;
      border-bottom:1px dashed rgba(255,255,255,.08);
      font-size: 13px;
      color: var(--muted);
    }
    .scoreRow:last-child{ border-bottom:0; }
    .scoreRow strong{ color:var(--text); font-weight: 700; }
    .pill{
      font-variant-numeric: tabular-nums;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--text);
      min-width: 44px;
      text-align:center;
    }
    .alert{
      border:1px solid rgba(251,113,133,.35);
      background: rgba(251,113,133,.10);
      border-radius: 16px;
      padding: 12px;
      color: var(--text);
      font-size: 13px;
    }
    .mutedBox{
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.16);
      border-radius: 16px;
      padding: 12px;
      color: var(--muted);
      font-size: 13px;
    }
    footer{
      max-width: 980px;
      margin: 0 auto;
      padding: 0 16px 30px;
      color: var(--muted);
      font-size: 12px;
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
      color: var(--text);
    }
  </style>
</head>
<body>
<header>
  <div class="title">
    <div>
      <h1>Экспресс-диагностика состояния</h1>
      <p class="subtitle">
        60–90 секунд. Получи ближайшее состояние и короткий протокол “что делать сейчас”.
        Это не мед. диагноз, а <b>триаж</b> (быстро определить доминирующий режим).
      </p>
    </div>
    <div class="row">
      <span class="chip">Версия: <b>v1</b></span>
      <button class="btn ghost" id="btnReset" title="Сбросить ответы">Сброс</button>
    </div>
  </div>
</header>

<main>
  <!-- Left: Form -->
  <section class="card">
    <div class="hd">
      <div class="row" style="justify-content:space-between;">
        <div>
          <div class="sectionTitle">Шаг 1 — главный симптом</div>
          <div class="hint">Выбери то, что ближе всего <b>прямо сейчас</b>.</div>
        </div>
        <span class="badge" id="progressBadge"><strong>0</strong>/8</span>
      </div>
    </div>
    <div class="bd">

      <div class="fieldset">
        <label class="label" for="primarySymptom"><b>Главный симптом</b></label>
        <div class="hint">Это даст системе “первичный приоритет”.</div>
        <div style="margin-top:10px;">
          <select id="primarySymptom">
            <option value="">— не выбрано —</option>
            <option value="anxiety">Тревога / страх / внутренний мандраж</option>
            <option value="anger">Злость / раздражение / “сейчас взорвусь”</option>
            <option value="fog">Туман / расфокус / тупняк</option>
            <option value="fatigue">Усталость / выжатость / апатия</option>
            <option value="hustle">Суета / много мыслей / не могу остановиться</option>
            <option value="stuck">Залип / прокрастинация / не могу начать</option>
            <option value="sadness">Ком / печаль / хочется плакать</option>
            <option value="body">Зажимы в теле / шея-плечи / голова</option>
          </select>
        </div>
      </div>

      <div class="sectionTitle">Шаг 2 — 8 вопросов (Да/Нет)</div>
      <div class="hint">Отвечай быстро. Если сомневаешься — выбирай то, что ближе.</div>

      <div class="fieldset" id="questions">
        <!-- Questions inserted by JS -->
      </div>

      <div class="row" style="justify-content:space-between; margin-top: 14px;">
        <button class="btn primary" id="btnCalc">Получить результат</button>
        <div class="small">Подсказка: можно нажать <span class="kbd">Enter</span></div>
      </div>

      <div style="margin-top:14px;" class="mutedBox">
        <b>Если совсем непонятно:</b> выбери главный симптом и ответь хотя бы на 3–4 вопроса.
        Алгоритм всё равно даст ориентир.
      </div>

    </div>
  </section>

  <!-- Right: Results -->
  <aside class="card">
    <div class="hd">
      <div class="sectionTitle">Результат и что делать</div>
      <div class="hint">Показываем доминирующее состояние и быстрый протокол.</div>
    </div>
    <div class="bd">
      <div id="redFlags" class="alert" style="display:none; margin-bottom:12px;">
        <b>Красные флаги:</b> если есть острая боль в груди, сильная одышка, внезапная сильнейшая головная боль,
        слабость/онемение одной стороны, спутанность речи/сознания — лучше не “протоколы”, а мед. помощь.
      </div>

      <div class="resultBox" id="resultBox">
        <div class="mutedBox">
          Заполни ответы и нажми <b>“Получить результат”</b>.
        </div>
      </div>

      <div class="scores" id="scoresBox" style="display:none;">
        <div class="sectionTitle">Баллы (для прозрачности)</div>
        <div id="scoresList"></div>
      </div>

    </div>
  </aside>
</main>

<footer>
  <div>
    Можно расширять: добавить аудио-треки, ссылку на главы книги, историю результатов (localStorage), таймеры и т.д.
  </div>
</footer>

<script>
/**
 * v1: Simple triage scoring
 * States:
 *  anxiety, anger, fog, fatigue, hustle, stuck, sadness, body
 */
const STATES = {
  anxiety: {
    name: "Тревожная активация",
    short: "тревога",
    desc: "Организм в режиме угрозы: сжатие в груди, поверхностное дыхание, желание контролировать/проверять.",
    doNow: [
      "Остановись физически на 3 секунды. Почувствуй стопы.",
      "Сделай 1 длинный выдох (медленнее вдоха). Повтори 3 раза.",
      "Положи ладонь на грудь/живот: “я в безопасности прямо сейчас”.",
      "Выбери 1 следующий маленький шаг на 2 минуты."
    ],
    avoid: "Не пытайся “успокоиться полностью”. Цель — снизить градус на 10–20%."
  },
  anger: {
    name: "Перегрев / раздражение",
    short: "злость",
    desc: "Чаще всего: накопление напряжения + границы. Тело готовится “давить” или “защищаться”.",
    doNow: [
      "Разожми челюсть: зубы не касаются, язык мягко у нёба.",
      "Опусти плечи на выдохе. 5 медленных кругов плечами назад.",
      "Сделай безопасный “слив пара” 60 сек: сильно сжать кулаки на вдохе → отпустить на выдохе.",
      "Спроси себя: “Какую границу надо поставить? Что попросить?”"
    ],
    avoid: "Не веди важные переговоры на пике. Сначала сброс напряжение."
  },
  fog: {
    name: "Туман / перегруз внимания",
    short: "туман",
    desc: "Оперативка переполнена или не хватает сна/топлива. Мозг “ватный”, фокус не держится.",
    doNow: [
      "Вода: выпей 250–400 мл. Если голоден — быстрый перекус.",
      "Свет/движение: 2 минуты пройтись или открыть окно.",
      "Одна задача: выпиши 3 пункта и сделай только первый 7 минут (таймер).",
      "После 7 минут — пауза 1 минуту и повтор."
    ],
    avoid: "Не пытайся решать всё сразу. Ум в тумане любит расползаться."
  },
  fatigue: {
    name: "Истощение / низкий ресурс",
    short: "усталость",
    desc: "Ресурс реально на нуле (а не “ленивый”). Нужна бережная разгрузка и восстановление.",
    doNow: [
      "Сократи обязательства: выбери 1–2 “обязательных” дела, остальное перенеси/упрости.",
      "20 минут покоя: лечь/полулёжа, закрыть глаза, дыхание свободное.",
      "Тёплая поддержка телу: плед/чай/душ (что доступно).",
      "Спроси: “что самое малое вернёт мне 10% энергии?”"
    ],
    avoid: "Не дави на себя мотивацией. Здесь работает восстановление, а не “поднажать”."
  },
  hustle: {
    name: "Ментальная суета / переполнение",
    short: "суета",
    desc: "Не обязательно страх. Скорее слишком много активных “надо” в голове одновременно.",
    doNow: [
      "Выгрузка: выпиши всё, что крутится (2–4 минуты) без порядка.",
      "Пометь 1 пункт как “сейчас” и 2 пункта как “потом”. Остальное — парковка.",
      "3 цикла: вдох 4 сек → выдох 6 сек (без усилия).",
      "Сделай 1 действие по пункту “сейчас” (2 минуты)."
    ],
    avoid: "Не решай при суете стратегические вопросы. Сначала разгрузи оперативку."
  },
  stuck: {
    name: "Залип / избегание",
    short: "залип",
    desc: "Обычно это смесь: тревога + стыд/неприятность задачи. Тело “закрывается”.",
    doNow: [
      "Сделай задачу меньше: “только открыть / только начать / только 2 минуты”.",
      "Убери трение: подготовь рабочее место, открой нужный файл, поставь таймер 2:00.",
      "Скажи: “мне не надо заканчивать — мне надо начать”.",
      "Если пошло — продли ещё на 5 минут."
    ],
    avoid: "Не пытайся победить волей. Здесь выигрывает уменьшение шага."
  },
  sadness: {
    name: "Печаль / эмоциональная разрядка",
    short: "печаль",
    desc: "Чувство просит прожиться. Ком в горле/груди, хочется выдохнуть, иногда плакать.",
    doNow: [
      "Разреши: “сейчас во мне печаль, и это нормально”.",
      "Дыхание через горло мягко: длинный выдох, как “ууу-хаа”. 6 раз.",
      "Положи ладонь на грудь: 60 секунд просто быть рядом с ощущением.",
      "Если хочется — письмо на 5 минут: “мне больно потому что…”"
    ],
    avoid: "Не гони себя в “веселье”. Лучше дать чувству пройти свой цикл."
  },
  body: {
    name: "Тело кричит / зажимы",
    short: "тело",
    desc: "Первично телесный паттерн: шея-плечи, челюсть, диафрагма, голова. Психика часто вторична.",
    doNow: [
      "Скан: лоб → челюсть → шея → плечи → грудь → живот (30 секунд).",
      "Разожми челюсть + “плечи вниз на выдохе” 6 раз.",
      "Мягкая мобилизация: наклоны головы вправо/влево по 3 раза (без боли).",
      "Тёплая вода/душ или 2 минуты ходьбы."
    ],
    avoid: "Не растягивайся через боль. Лучше мягко и регулярно."
  }
};

const QUESTIONS = [
  { id:"q1", text:"Есть ли учащённое сердцебиение / мелкое дыхание / ощущение “опасности”?", map:{ anxiety:3, hustle:1, stuck:1 } },
  { id:"q2", text:"Состояние нарастало последние 2–7 дней (накопление)?", map:{ fatigue:2, anger:2, fog:2, hustle:1 } },
  { id:"q3", text:"Плохо спал(а) 2 ночи подряд или < 6.5 часов?", map:{ fog:3, fatigue:2, anxiety:1, anger:1 } },
  { id:"q4", text:"Есть явные зажимы: челюсть/шея/трапеции/диафрагма?", map:{ body:3, anger:2, anxiety:1 } },
  { id:"q5", text:"Сегодня ел(а)/пил(а) воду нормально? (Если НЕТ — отмечай НЕТ)", special:"reverse", map:{ fog:2, fatigue:1, anxiety:1 } },
  { id:"q6", text:"В голове одновременно больше 3 “срочных надо”?", map:{ hustle:3, anxiety:2, fog:1 } },
  { id:"q7", text:"Причина связана с человеком/разговором/обидой/конфликтом?", map:{ anger:3, sadness:2, anxiety:1 } },
  { id:"q8", text:"Есть мысль “не вижу смысла / всё бессмысленно” прямо сейчас?", map:{ sadness:3, fatigue:2, stuck:2 } },
];

const primarySymptom = document.getElementById("primarySymptom");
const questionsWrap = document.getElementById("questions");
const btnCalc = document.getElementById("btnCalc");
const btnReset = document.getElementById("btnReset");
const resultBox = document.getElementById("resultBox");
const scoresBox = document.getElementById("scoresBox");
const scoresList = document.getElementById("scoresList");
const progressBadge = document.getElementById("progressBadge");
const redFlags = document.getElementById("redFlags");

const answers = {}; // qid -> true/false/null

function renderQuestions(){
  questionsWrap.innerHTML = "";
  QUESTIONS.forEach((q)=>{
    answers[q.id] = null;

    const row = document.createElement("div");
    row.className = "q";

    const left = document.createElement("div");
    left.className = "txt";
    left.innerHTML = `<div class="label"><b>${q.text}</b></div>` + (q.special==="reverse"
      ? `<div class="hint">Важно: тут “НЕТ” означает фактор риска (голод/жажда).</div>`
      : ``);

    const toggles = document.createElement("div");
    toggles.className = "seg";
    const yes = document.createElement("button");
    yes.type="button";
    yes.textContent = "Да";
    const no = document.createElement("button");
    no.type="button";
    no.textContent = "Нет";

    function setActive(val){
      answers[q.id] = val;
      yes.classList.toggle("active", val===true);
      no.classList.toggle("active", val===false);
      updateProgress();
    }

    yes.addEventListener("click", ()=> setActive(true));
    no.addEventListener("click", ()=> setActive(false));

    toggles.appendChild(yes);
    toggles.appendChild(no);

    row.appendChild(left);
    row.appendChild(toggles);

    questionsWrap.appendChild(row);
  });

  updateProgress();
}

function updateProgress(){
  const done = Object.values(answers).filter(v => v !== null).length;
  progressBadge.innerHTML = `<strong>${done}</strong>/8`;
}

function calcScores(){
  const scores = {};
  Object.keys(STATES).forEach(k => scores[k]=0);

  // Primary symptom weight
  const prim = primarySymptom.value;
  if(prim && scores[prim] !== undefined){
    scores[prim] += 3;
  }

  // Questions scoring
  QUESTIONS.forEach(q=>{
    const val = answers[q.id];
    if(val === null) return;

    // reverse question means "No" is the risk signal
    const active = (q.special==="reverse") ? (val === false) : (val === true);
    if(!active) return;

    for(const [state, pts] of Object.entries(q.map)){
      scores[state] += pts;
    }
  });

  return scores;
}

function sortStates(scores){
  const arr = Object.keys(scores).map(k => ({ key:k, score:scores[k] }));
  arr.sort((a,b)=> b.score - a.score);
  return arr;
}

function renderResult(scores){
  const sorted = sortStates(scores);
  const top = sorted[0];
  const second = sorted[1];

  // Show red flags block always available (could toggle by extra questions later)
  redFlags.style.display = "block";

  // If everything is zero (no answers)
  const total = Object.values(scores).reduce((a,b)=>a+b,0);
  if(total === 0 && !primarySymptom.value){
    resultBox.innerHTML = `<div class="mutedBox">Пока нет данных. Выбери главный симптом и/или ответь на вопросы.</div>`;
    scoresBox.style.display = "none";
    return;
  }

  const topState = STATES[top.key];
  const closeSecond = second && (second.score >= top.score - 2) && second.score > 0;

  const secondHtml = closeSecond ? `
    <div class="badge" style="margin-top:6px;">
      Второе рядом: <strong>${STATES[second.key].name}</strong> <span class="pill">${second.score}</span>
    </div>
    <div class="resDesc">Если первый протокол не “заходит” за 3–5 минут — попробуй второй трек/протокол.</div>
  ` : "";

  const stepsHtml = topState.doNow.map(s => `<li>${s}</li>`).join("");

  resultBox.innerHTML = `
    <div class="badge">
      Доминирует: <strong>${topState.short}</strong> <span class="pill">${top.score}</span>
    </div>
    <div class="resTitle">${topState.name}</div>
    <div class="resDesc">${topState.desc}</div>
    ${secondHtml}
    <div style="margin-top:10px;">
      <div class="sectionTitle">Что делать сейчас (5–10 минут)</div>
      <ul class="steps">${stepsHtml}</ul>
      <div class="small" style="margin-top:10px;"><b>Не делать:</b> ${topState.avoid}</div>
    </div>
  `;

  // Scores transparency
  scoresBox.style.display = "block";
  scoresList.innerHTML = sorted.map(item => {
    const st = STATES[item.key];
    return `
      <div class="scoreRow">
        <div><strong>${st.short}</strong> <span class="small">— ${st.name}</span></div>
        <div class="pill">${item.score}</div>
      </div>
    `;
  }).join("");
}

function resetAll(){
  primarySymptom.value = "";
  QUESTIONS.forEach(q => answers[q.id]=null);
  renderQuestions();
  resultBox.innerHTML = `<div class="mutedBox">Заполни ответы и нажми <b>“Получить результат”</b>.</div>`;
  scoresBox.style.display = "none";
  redFlags.style.display = "none";
}

btnCalc.addEventListener("click", ()=>{
  const scores = calcScores();
  renderResult(scores);
});

btnReset.addEventListener("click", resetAll);

document.addEventListener("keydown", (e)=>{
  if(e.key === "Enter"){
    e.preventDefault();
    const scores = calcScores();
    renderResult(scores);
  }
});

renderQuestions();
</script>
</body>
</html>
